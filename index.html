<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Queue - ‡∏à‡∏±‡∏î‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏û‡∏•‡∏á‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.1rem;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .price-display {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 15px 0;
        }

        .room-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .info-item .label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .info-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .queue-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .queue-item.current {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-left-color: #28a745;
        }

        .queue-item .song-info {
            flex: 1;
        }

        .queue-item .song-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .queue-item .song-added-by {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .queue-item.current .song-added-by {
            color: rgba(255,255,255,0.8);
        }

        .queue-controls {
            display: flex;
            gap: 10px;
        }

        .youtube-player {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .qr-code {
            text-align: center;
            margin: 20px 0;
        }

        .qr-code canvas {
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 10px;
            background: white;
        }

        .share-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #333;
        }

        .hidden {
            display: none;
        }

        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .timer.warning {
            color: #ffc107;
            animation: pulse 1s infinite;
        }

        .timer.critical {
            color: #dc3545;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .guest-form {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .pending-requests {
            max-height: 300px;
            overflow-y: auto;
        }

        .request-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: #e9ecef;
            border-radius: 8px;
        }

        .disclaimer {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
            font-size: 0.9rem;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .room-info {
                grid-template-columns: 1fr;
            }
            
            .share-options {
                flex-direction: column;
            }
            
            .queue-controls {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ Music Queue</h1>
            <p>‡∏à‡∏±‡∏î‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏û‡∏•‡∏á‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏≤‡∏£‡∏≤‡πÇ‡∏≠‡πÄ‡∏Å‡∏∞ ‡∏´‡πâ‡∏≠‡∏á‡∏ã‡πâ‡∏≠‡∏° ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå</p>
        </div>

        <!-- Home Screen -->
        <div id="homeScreen" class="card">
            <h2>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
            <div style="display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap;">
                <button class="btn" onclick="showCreateRoom()">üè† ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                <button class="btn btn-secondary" onclick="showJoinRoom()">üîó ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</button>
            </div>
        </div>

        <!-- Create Room Screen -->
        <div id="createRoomScreen" class="card hidden">
            <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h2>
            <div class="input-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á</label>
                <input type="text" id="roomName" placeholder="‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏≤‡∏£‡∏≤‡πÇ‡∏≠‡πÄ‡∏Å‡∏∞‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤" value="‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏≤‡∏£‡∏≤‡πÇ‡∏≠‡πÄ‡∏Å‡∏∞‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤">
            </div>
            <div class="input-group">
                <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πà‡∏≤ (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</label>
                <select id="rentalHours" onchange="calculatePrice()">
                    <option value="1">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                    <option value="2">2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                    <option value="3">3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                    <option value="4">4 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                    <option value="5">5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                    <option value="6">6 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                    <option value="8">8 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                </select>
            </div>
            <div id="priceDisplay" class="price-display">
                ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: 20 ‡∏ö‡∏≤‡∏ó
            </div>
            <div class="input-group">
                <label>
                    <input type="checkbox" id="enableGuestForm" style="width: auto; margin-right: 10px;">
                    ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Spam)
                </label>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn" onclick="createRoom()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
                <button class="btn btn-secondary" onclick="showHome()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>

        <!-- Join Room Screen -->
        <div id="joinRoomScreen" class="card hidden">
            <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</h2>
            <div class="input-group">
                <label>‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á</label>
                <input type="text" id="joinRoomId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn" onclick="joinRoom()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
                <button class="btn btn-secondary" onclick="showHome()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>

        <!-- Guest Form Screen -->
        <div id="guestFormScreen" class="card hidden">
            <h2>‡∏Ç‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</h2>
            <div class="guest-form">
                <p>‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            </div>
            <div class="input-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
                <input type="text" id="guestName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
            </div>
            <div class="input-group">
                <label>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                <input type="text" id="guestReason" placeholder="‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏î‡πâ‡∏ß‡∏¢">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn" onclick="submitGuestRequest()">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
                <button class="btn btn-secondary" onclick="showHome()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>

        <!-- Main Room Screen -->
        <div id="roomScreen" class="card hidden">
            <div class="room-info">
                <div class="info-item">
                    <div class="label">‡∏´‡πâ‡∏≠‡∏á</div>
                    <div class="value" id="currentRoomName">-</div>
                </div>
                <div class="info-item">
                    <div class="label">‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                    <div class="value timer" id="timeRemaining">-</div>
                </div>
            </div>

            <!-- Master Controls -->
            <div id="masterControls" class="hidden">
                <h3>üéõÔ∏è ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡πâ‡∏≠‡∏á</h3>
                <div style="display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="showShareOptions()">üì§ ‡πÅ‡∏ä‡∏£‡πå‡∏´‡πâ‡∏≠‡∏á</button>
                    <button class="btn btn-secondary" onclick="showExtendTime()">‚è∞ ‡∏ï‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤</button>
                    <button class="btn btn-secondary" onclick="showTransferMaster()">üëë ‡πÇ‡∏≠‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
                    <button class="btn btn-secondary" onclick="toggleGuestForm()">üõ°Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</button>
                </div>
                
                <!-- Pending Requests -->
                <div id="pendingRequestsSection" class="hidden">
                    <h4>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</h4>
                    <div id="pendingRequests" class="pending-requests"></div>
                </div>
            </div>

            <!-- YouTube Player -->
            <div id="playerSection">
                <div id="ytPlayer" class="youtube-player"></div>
                <div style="text-align: center; margin-bottom: 20px;">
                    <button class="btn" onclick="playNext()" id="playNextBtn">‚è≠Ô∏è ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
                </div>
            </div>

            <!-- Add Song -->
            <div>
                <h3>üéµ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á</h3>
                <div class="input-group">
                    <label>‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube</label>
                    <input type="text" id="songUrl" placeholder="https://www.youtube.com/watch?v=..." onkeypress="handleSongUrlEnter(event)">
                </div>
                <div class="input-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°</label>
                    <input type="text" id="addedBy" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                </div>
                <button class="btn" onclick="addSong()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á</button>
            </div>

            <!-- Queue -->
            <div style="margin-top: 30px;">
                <h3>üìã ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏û‡∏•‡∏á</h3>
                <div id="songQueue"></div>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-danger" onclick="leaveRoom()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á</button>
            </div>
        </div>

        <!-- Share Options Modal -->
        <div id="shareModal" class="card hidden">
            <h3>‡πÅ‡∏ä‡∏£‡πå‡∏´‡πâ‡∏≠‡∏á</h3>
            <div class="input-group">
                <label>‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á</label>
                <input type="text" id="shareRoomId" readonly>
                <button class="btn btn-secondary" onclick="copyRoomId()" style="margin-top: 10px;">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
            </div>
            <div class="input-group">
                <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡πâ‡∏≠‡∏á</label>
                <input type="text" id="shareRoomUrl" readonly>
                <button class="btn btn-secondary" onclick="copyRoomUrl()" style="margin-top: 10px;">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
            </div>
            <div class="qr-code">
                <div>‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</div>
                <canvas id="qrCode"></canvas>
            </div>
            <button class="btn btn-secondary" onclick="hideShareOptions()">‡∏õ‡∏¥‡∏î</button>
        </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
            <strong>‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</strong> ‡πÅ‡∏≠‡∏õ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ï‡∏£‡∏µ‡∏°‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏î ‡πÜ ‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏ú‡πà‡∏≤‡∏ô YouTube ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á YouTube ‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÜ
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Global variables
        let currentRoom = null;
        let isMaster = false;
        let userId = generateUserId();
        let ytPlayer = null;
        let currentSongIndex = 0;
        let timeRemaining = 0;
        let timerInterval = null;

        // Generate unique user ID
        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9);
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Screen navigation
        function showHome() {
            hideAllScreens();
            document.getElementById('homeScreen').classList.remove('hidden');
        }

        function showCreateRoom() {
            hideAllScreens();
            document.getElementById('createRoomScreen').classList.remove('hidden');
            calculatePrice();
        }

        function showJoinRoom() {
            hideAllScreens();
            document.getElementById('joinRoomScreen').classList.remove('hidden');
        }

        function hideAllScreens() {
            const screens = ['homeScreen', 'createRoomScreen', 'joinRoomScreen', 'guestFormScreen', 'roomScreen', 'shareModal'];
            screens.forEach(id => document.getElementById(id).classList.add('hidden'));
        }

        // Price calculation
        function calculatePrice() {
            const hours = parseInt(document.getElementById('rentalHours').value);
            const pricePerHour = hours >= 4 ? 15 : 20;
            const totalPrice = hours * pricePerHour;
            
            document.getElementById('priceDisplay').innerHTML = `
                ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: ${totalPrice} ‡∏ö‡∏≤‡∏ó
                ${hours >= 4 ? '<br><small>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 4 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ!</small>' : ''}
            `;
        }

        // Create room
        function createRoom() {
            const roomName = document.getElementById('roomName').value.trim();
            const hours = parseInt(document.getElementById('rentalHours').value);
            const enableGuestForm = document.getElementById('enableGuestForm').checked;
            
            if (!roomName) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á', 'error');
                return;
            }

            // Generate room ID
            const roomId = generateRoomId();
            
            // Create room object
            currentRoom = {
                id: roomId,
                name: roomName,
                masterId: userId,
                hours: hours,
                enableGuestForm: enableGuestForm,
                startTime: Date.now(),
                endTime: Date.now() + (hours * 60 * 60 * 1000),
                queue: [],
                members: [userId],
                pendingRequests: []
            };

            isMaster = true;
            timeRemaining = hours * 60 * 60 * 1000; // Convert to milliseconds
            
            showRoom();
            startTimer();
            showNotification('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        function generateRoomId() {
            return Math.random().toString(36).substr(2, 8).toUpperCase();
        }

        // Join room
        function joinRoom() {
            const roomId = document.getElementById('joinRoomId').value.trim().toUpperCase();
            
            if (!roomId) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á', 'error');
                return;
            }

            // Simulate room lookup
            const mockRoom = {
                id: roomId,
                name: '‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                masterId: 'other_user',
                hours: 2,
                enableGuestForm: Math.random() > 0.5,
                startTime: Date.now() - (30 * 60 * 1000), // Started 30 mins ago
                endTime: Date.now() + (90 * 60 * 1000), // 1.5 hours remaining
                queue: [],
                members: ['other_user'],
                pendingRequests: []
            };

            if (mockRoom.enableGuestForm) {
                currentRoom = mockRoom;
                showGuestForm();
            } else {
                currentRoom = mockRoom;
                currentRoom.members.push(userId);
                isMaster = false;
                timeRemaining = mockRoom.endTime - Date.now();
                showRoom();
                startTimer();
                showNotification('‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            }
        }

        // Guest form
        function showGuestForm() {
            hideAllScreens();
            document.getElementById('guestFormScreen').classList.remove('hidden');
        }

        function submitGuestRequest() {
            const name = document.getElementById('guestName').value.trim();
            const reason = document.getElementById('guestReason').value.trim();
            
            if (!name) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô', 'error');
                return;
            }

            // Add to pending requests
            currentRoom.pendingRequests.push({
                userId: userId,
                name: name,
                reason: reason,
                timestamp: Date.now()
            });

            showNotification('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥...', 'success');
            
            // Simulate approval after 3 seconds
            setTimeout(() => {
                currentRoom.members.push(userId);
                isMaster = false;
                timeRemaining = currentRoom.endTime - Date.now();
                showRoom();
                startTimer();
                showNotification('‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            }, 3000);
        }

        // Show room
        function showRoom() {
            hideAllScreens();
            document.getElementById('roomScreen').classList.remove('hidden');
            
            // Update room info
            document.getElementById('currentRoomName').textContent = currentRoom.name;
            
            // Show master controls if user is master
            if (isMaster) {
                document.getElementById('masterControls').classList.remove('hidden');
                updatePendingRequests();
            }

            // Initialize YouTube player
            initYouTubePlayer();
            
            // Update queue display
            updateQueueDisplay();
        }

        // Timer functions
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeRemaining -= 1000;
                updateTimerDisplay();
                
                if (timeRemaining <= 15 * 60 * 1000 && timeRemaining > 14 * 60 * 1000) {
                    // 15 minutes warning
                    if (isMaster) {
                        showNotification('‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ 15 ‡∏ô‡∏≤‡∏ó‡∏µ! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', 'warning');
                    }
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    endSession();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60000);
            const seconds = Math.floor((timeRemaining % 60000) / 1000);
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById('timeRemaining');
            timerElement.textContent = display;
            
            // Update timer style based on remaining time
            timerElement.className = 'value timer';
            if (timeRemaining <= 5 * 60 * 1000) {
                timerElement.classList.add('critical');
            } else if (timeRemaining <= 15 * 60 * 1000) {
                timerElement.classList.add('warning');
            }
        }

        function endSession() {
            showNotification('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'warning');
            // Disable adding new songs
            document.getElementById('songUrl').disabled = true;
            document.getElementById('addedBy').disabled = true;
        }

        // YouTube Player functions
        function initYouTubePlayer() {
            // Load YouTube API
            if (!window.YT) {
                const script = document.createElement('script');
                script.src = 'https://www.youtube.com/iframe_api';
                document.head.appendChild(script);
                
                window.onYouTubeIframeAPIReady = createYouTubePlayer;
            } else {
                createYouTubePlayer();
            }
        }

        function createYouTubePlayer() {
            ytPlayer = new YT.Player('ytPlayer', {
                height: '300',
                width: '100%',
                videoId: '',
                playerVars: {
                    'playsinline': 1,
                    'rel': 0,
                    'showinfo': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            console.log('YouTube player ready');
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                playNext();
            }
        }

        function extractVideoId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        // Song management
        function addSong() {
            const url = document.getElementById('songUrl').value.trim();
            const addedBy = document.getElementById('addedBy').value.trim() || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
            
            if (!url) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube', 'error');
                return;
            }

            const videoId = extractVideoId(url);
            if (!videoId) {
                showNotification('‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }

            // Add to queue
            const song = {
                id: Date.now(),
                videoId: videoId,
                url: url,
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...',
                addedBy: addedBy,
                timestamp: Date.now()
            };

            currentRoom.queue.push(song);
            
            // Clear inputs
            document.getElementById('songUrl').value = '';
            document.getElementById('addedBy').value = '';
            
            updateQueueDisplay();
            showNotification('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');

            // Get video title
            fetchVideoTitle(videoId, song.id);

            // If this is the first song and no song is playing, start playing
            if (currentRoom.queue.length === 1 && ytPlayer && ytPlayer.getPlayerState() !== YT.PlayerState.PLAYING) {
                playCurrentSong();
            }
        }

        function fetchVideoTitle(videoId, songId) {
            // Simulate fetching video title
            setTimeout(() => {
                const titles = [
                    '‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏∏‡∏î‡∏Æ‡∏¥‡∏ï 2024',
                    '‡πÄ‡∏û‡∏•‡∏á‡∏£‡∏±‡∏Å‡πÄ‡∏®‡∏£‡πâ‡∏≤',
                    '‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏≤‡∏Å‡∏•‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°',
                    '‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏ó‡∏¢‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÜ',
                    '‡πÄ‡∏û‡∏•‡∏á‡∏õ‡πä‡∏≠‡∏õ‡∏™‡∏∏‡∏î‡∏°‡∏±‡∏ô‡∏™‡πå'
                ];
                const randomTitle = titles[Math.floor(Math.random() * titles.length)];
                
                const song = currentRoom.queue.find(s => s.id === songId);
                if (song) {
                    song.title = randomTitle;
                    updateQueueDisplay();
                }
            }, 1000);
        }

        function handleSongUrlEnter(event) {
            if (event.key === 'Enter') {
                addSong();
            }
        }

        function updateQueueDisplay() {
            const queueContainer = document.getElementById('songQueue');
            
            if (currentRoom.queue.length === 0) {
                queueContainer.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß</p>';
                return;
            }

            queueContainer.innerHTML = currentRoom.queue.map((song, index) => `
                <div class="queue-item ${index === currentSongIndex ? 'current' : ''}">
                    <div class="song-info">
                        <div class="song-title">${song.title}</div>
                        <div class="song-added-by">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢: ${song.addedBy}</div>
                    </div>
                    <div class="queue-controls">
                        ${isMaster ? `
                            <button class="btn btn-secondary" onclick="moveSongUp(${index})" ${index === 0 ? 'disabled' : ''}>‚Üë</button>
                            <button class="btn btn-secondary" onclick="moveSongDown(${index})" ${index === currentRoom.queue.length - 1 ? 'disabled' : ''}>‚Üì</button>
                            <button class="btn btn-danger" onclick="removeSong(${index})">√ó</button>
                        ` : ''}
                        <button class="btn btn-secondary" onclick="openYouTube('${song.url}')">üîó</button>
                    </div>
                </div>
            `).join('');
        }

        function playCurrentSong() {
            if (currentRoom.queue.length === 0 || !ytPlayer) return;
            
            const currentSong = currentRoom.queue[currentSongIndex];
            if (currentSong) {
                ytPlayer.loadVideoById(currentSong.videoId);
                updateQueueDisplay();
            }
        }

        function playNext() {
            if (currentSongIndex < currentRoom.queue.length - 1) {
                currentSongIndex++;
                playCurrentSong();
                showNotification('‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ', 'success');
            } else {
                showNotification('‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'warning');
            }
        }

        function moveSongUp(index) {
            if (index > 0 && index !== currentSongIndex) {
                const temp = currentRoom.queue[index];
                currentRoom.queue[index] = currentRoom.queue[index - 1];
                currentRoom.queue[index - 1] = temp;
                
                // Adjust current song index if needed
                if (currentSongIndex === index - 1) {
                    currentSongIndex = index;
                } else if (currentSongIndex === index) {
                    currentSongIndex = index - 1;
                }
                
                updateQueueDisplay();
            }
        }

        function moveSongDown(index) {
            if (index < currentRoom.queue.length - 1 && index !== currentSongIndex) {
                const temp = currentRoom.queue[index];
                currentRoom.queue[index] = currentRoom.queue[index + 1];
                currentRoom.queue[index + 1] = temp;
                
                // Adjust current song index if needed
                if (currentSongIndex === index + 1) {
                    currentSongIndex = index;
                } else if (currentSongIndex === index) {
                    currentSongIndex = index + 1;
                }
                
                updateQueueDisplay();
            }
        }

        function removeSong(index) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                currentRoom.queue.splice(index, 1);
                
                // Adjust current song index
                if (currentSongIndex > index) {
                    currentSongIndex--;
                } else if (currentSongIndex === index && currentSongIndex >= currentRoom.queue.length) {
                    currentSongIndex = Math.max(0, currentRoom.queue.length - 1);
                }
                
                updateQueueDisplay();
                showNotification('‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        function openYouTube(url) {
            window.open(url, '_blank');
        }

        // Share functions
        function showShareOptions() {
            document.getElementById('shareRoomId').value = currentRoom.id;
            document.getElementById('shareRoomUrl').value = `${window.location.origin}${window.location.pathname}?room=${currentRoom.id}`;
            
            // Generate QR Code
            const canvas = document.getElementById('qrCode');
            QRCode.toCanvas(canvas, `${window.location.origin}${window.location.pathname}?room=${currentRoom.id}`, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#667eea',
                    light: '#ffffff'
                }
            });
            
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function hideShareOptions() {
            document.getElementById('shareModal').classList.add('hidden');
        }

        function copyRoomId() {
            const roomIdInput = document.getElementById('shareRoomId');
            roomIdInput.select();
            document.execCommand('copy');
            showNotification('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        function copyRoomUrl() {
            const roomUrlInput = document.getElementById('shareRoomUrl');
            roomUrlInput.select();
            document.execCommand('copy');
            showNotification('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Master controls
        function showExtendTime() {
            const hours = prompt('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏µ‡πà‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á?', '1');
            if (hours && !isNaN(hours) && hours > 0) {
                const additionalTime = parseInt(hours) * 60 * 60 * 1000;
                timeRemaining += additionalTime;
                currentRoom.endTime += additionalTime;
                
                const pricePerHour = hours >= 4 ? 15 : 20;
                const cost = parseInt(hours) * pricePerHour;
                
                showNotification(`‡∏ï‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ ${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (${cost} ‡∏ö‡∏≤‡∏ó)`, 'success');
            }
        }

        function showTransferMaster() {
            const memberList = currentRoom.members.filter(id => id !== userId);
            if (memberList.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á', 'warning');
                return;
            }
            
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                // Simulate transfer
                const newMaster = memberList[0];
                currentRoom.masterId = newMaster;
                isMaster = false;
                
                document.getElementById('masterControls').classList.add('hidden');
                showNotification('‡πÇ‡∏≠‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        function toggleGuestForm() {
            currentRoom.enableGuestForm = !currentRoom.enableGuestForm;
            const status = currentRoom.enableGuestForm ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î';
            showNotification(`${status}‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß`, 'success');
            updatePendingRequests();
        }

        function updatePendingRequests() {
            const section = document.getElementById('pendingRequestsSection');
            const container = document.getElementById('pendingRequests');
            
            if (currentRoom.pendingRequests.length === 0) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            container.innerHTML = currentRoom.pendingRequests.map(request => `
                <div class="request-item">
                    <div>
                        <strong>${request.name}</strong>
                        ${request.reason ? `<br><small>${request.reason}</small>` : ''}
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="approveRequest('${request.userId}')">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                        <button class="btn btn-danger" onclick="rejectRequest('${request.userId}')">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                    </div>
                </div>
            `).join('');
        }

        function approveRequest(requestUserId) {
            const requestIndex = currentRoom.pendingRequests.findIndex(req => req.userId === requestUserId);
            if (requestIndex !== -1) {
                const request = currentRoom.pendingRequests[requestIndex];
                currentRoom.members.push(requestUserId);
                currentRoom.pendingRequests.splice(requestIndex, 1);
                
                showNotification(`‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ${request.name} ‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                updatePendingRequests();
            }
        }

        function rejectRequest(requestUserId) {
            const requestIndex = currentRoom.pendingRequests.findIndex(req => req.userId === requestUserId);
            if (requestIndex !== -1) {
                const request = currentRoom.pendingRequests[requestIndex];
                currentRoom.pendingRequests.splice(requestIndex, 1);
                
                showNotification(`‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò ${request.name} ‡πÅ‡∏•‡πâ‡∏ß`, 'warning');
                updatePendingRequests();
            }
        }

        // Leave room
        function leaveRoom() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                if (timerInterval) clearInterval(timerInterval);
                currentRoom = null;
                isMaster = false;
                currentSongIndex = 0;
                timeRemaining = 0;
                
                showHome();
                showNotification('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        // URL parameter handling
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');
            
            if (roomId) {
                document.getElementById('joinRoomId').value = roomId;
                showJoinRoom();
            }
        }

        // Initialize app
        function initApp() {
            checkUrlParams();
            
            // Set default user name (with fallback)
            try {
                const savedName = localStorage.getItem('musicQueue_userName');
                if (savedName) {
                    document.getElementById('addedBy').value = savedName;
                }
            } catch (e) {
                console.log('localStorage not available');
            }
        }

        // Save user name when typing (with fallback for environments without localStorage)
        document.addEventListener('DOMContentLoaded', function() {
            const addedByInput = document.getElementById('addedBy');
            if (addedByInput) {
                // Load saved name if available
                try {
                    const savedName = localStorage.getItem('musicQueue_userName');
                    if (savedName) {
                        addedByInput.value = savedName;
                    }
                } catch (e) {
                    console.log('localStorage not available');
                }
                
                // Save name when typing
                addedByInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('musicQueue_userName', this.value);
                    } catch (e) {
                        console.log('localStorage not available');
                    }
                });
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initApp);

        // Handle browser back button
        window.addEventListener('popstate', function() {
            if (!currentRoom) {
                showHome();
            }
        });
    </script>
</body>
</html>
